Editor
========
This is about IntraMine's built-in Editor, with intramine_editor.pl on the back end, and editor.js on the front.

Choose your Editor
====================
To configure editing with IntraMine, see "Editing documents.txt". Basically you can set things up so that clicking on a "pencil" icon to the right of a file name will bring up either IntraMine's Editor (the default), or the editor of your choice.

What it's for
==================
IntraMine's Editor is aimed at creating better in-house documentation (especially for bringing new people up to speed) and development logs. Use Gloss to mark up your documents in the Editor and in addition to the plain text you'll also get:
 - full Gloss support (IntraMine's minimal memorable markdown variant for intranet documents)
 - FLASH links: type the file name, get a link (In IntraMine's Editor the edit link is a purple rectangle at the end of the link, like so: editorlink.png)
 - image hovers: this is a FLASH link to an image, pause your cursor over the image and the image pops up. In the Editor an image hover link has a lavender background, like so: editor_image_hover.png
 - glossary popups: pause the cursor over a term and a definition or explanation pops up
 - Go2: select a word or short phrase, pause the cursor, and links to relevant files will appear in a popup
 - and a synchronized table of contents.

Check out "Gloss.txt" to understand how to use Gloss, and I think you'll appreciate how simple it is to create documents that are easy to read.

Some features
=================
The Editor also has syntax highlighting for source files, a table of contents, and of course the ability to Save. 

If you close an Editor tab and later re-open it, you will be offered the opportunity to restore and save any unsaved changes.

There are buttons at the top for Save, Revert, Undo, Redo, Toggle, Find, View, and Save As. If it's a .txt file you'll also find a "Check" button that starts up spell checking. And standard key equivalents are also available:
TABLE
Action			Keys
savebutton.png			Ctrl+S
saveasbutton.png		Ctrl+Alt+S or Ctrl+Shift+S
undobutton.png			Ctrl+Z
redobutton.png			Ctrl+Shift+Z
findbutton.png			Ctrl+F
Cut				Ctrl+X
Copy			Ctrl+C
Paste			Ctrl+V
Select All		Ctrl+A
Indent			Ctrl+] (add a tab to selected lines)
Indent			Tab (same as above)
Outdent			Ctrl+[ (remove a tab from selected lines)
Outdent			Shift+Tab (same as above)

A date-time stamp can be inserted by pressing either F4 or Ctrl-Space.
F4: 			11:34 AM Monday, September 11, 2023
Ctrl-Space: 	Mon Sep 11 2023 11:34:58

And you have brace matching: click on or next to a curly brace ('{' or '}') to highlight it and its matching counterpart.
bracesEditor.png

At top left just to the left of the Save button you'll find a **chevron control** for the file path display. Click the chevron or text to the right of it to switch between showing the file name (default) and the file's full path. You can drag over the full path to select it.
chevron.gif

If you select a word or short phrase, it will be highlighted in the text and on the scroll bar. To cancel a highlight, click on a blank line or after a non-word character.

In documents longer than about 4,000 lines you'll see a precision thumb to help with scrolling to a highlight.

Standalone is special
======================
For most .txt files, links will be put in for any file specifier that matches an indexed file, and glossary entries will be taken from your collection of glossary_master.txt files. However, there are .txt files that need different handling, namely those that you are using as sources for standalone HTML files, as generated by gloss2html.pl. For those, you want to see glossary entries taken from any glossary.txt file in the same folder, and also limit links to files in the same folder, so there's a match with the resulting HTML version of the file. This happens in both the Editor and Viewer provided you have a glossary.txt file in the same folder.

How to start editing a file
===============================
Assuming you've configured IntraMine to use its own Editor (the default), you can bring up a source or text file in a new browser tab by clicking on the pencil icon edit1.png that accompanies all regular file links. Edit pencil links can be found in Search hits, and on links within file views as presented by the Viewer, as well as next to files listed on the Files page. Viewer displays also have an "Edit" button at the top. In IntraMine's Editor the edit link is a purple rectangle at the end of the link, like so: editorlink.png.

*Some pencil links in the Viewer, and a green "Edit" button at the top.*
2019-12-03 16_38_08-intramine_file_viewer_cm.pl.png

*An Editor view of this file. The cursor is paused over "Editor" on line 11, resulting in a glossary popup. There are FLASH links to "Editing documents.txt" etc, but no links to other file mentions such as "editor.js": standalone Gloss HTML files such as the ones in IntraMine's Documentation folder (including this file) can only link to files in the same folder. The purple rectangle on the right end of "Editing documents.txt" on line 7 is an Edit link.*
Editor.png

Auto-refresh
==============
Files displayed with IntraMine's Viewer will auto-refresh instantly when changed by IntraMine's Editor, scrolling to the line where the Editor's cursor is. If you use some other editor, the refresh in the Viewer will take 1-2 seconds, and the top displayed line won't change. Auto-refresh is especially handy for working on Markdown or Gloss files: open a file in the Viewer and any editor, then see your changes rendered immediately after a Save.

Spell checking
================
The Editor can spell check .txt files. When you open a .txt file in the Editor, you'll see a "Check" button at the top right, and at this point the checker is turned off. When you click it, the button reads "Checking" in white text and spell checking is turned on. You'll see the standard wavy red line under any marked spelling "error." It is of course not perfect, but you should find it's good enough (467,000 known words) that you can turn it on to check your spelling and then turn if off if the red wavy lines are distracting.

Spell checker on/off is remembered across sessions for each file. Only displayed lines are checked at one time, so there won't be any slowdown when the spell checker is on.

The spell checker uses a single word list, in data/EnglishWords.txt (in your IntraMine folder). You can add words to this file if you want, the simple format is one word per line. And it's harmless to duplicate entries.

By the way, you're not limited to English words, much of Unicode is supported.

Note however that words fewer than four characters in length are **not checked**. So the spell checking isn't of much use for languages such as Chinese.

*Spell checking off*: "checkingoff.png"

*Spell checking on*: "checkingon.png"

Adding words to the dictionary
------------------------------
Hold down the SHIFT key and RIGHT click in the word you want to add (it will have a red squiggly underline).The word will be added to your dictionary, and the reg squiggly underline will go away.

To add a whole bunch of words at once, as mentioned above open data/EnglishWords.txt and paste in the words, one per line.

@@@@@

Under the hood
==============
File load sequence
------------------
1. An Edit link or button is clicked, triggering a call to viewerLinks.js#editOpen() (this could be in a read-only view, or Search hits, or under Files).
2. If data/intramine_config.txt values have been set to use IntraMine's Editor, editOpen() calls viewerLinks.js#editWithIntraMine() which opens a new browser tab that invokes the Editor, schematically
 -- http://host:port/Editor/?href=path to file
3. "$RequestAction{'href'} = \&FullFile;" near the top of intramine_editor.pl registers FullFile() as the handler for any "href=..." request. This is detected by swarmserver.pm#MainLoop() as usual, which issues a call to FullFile(). The file path is in its $formH->{'href'} argument
4. FullFile() returns the basic HTML for the page and includes editor.js and CodeMirror files.
5. When the loading of the new page is complete, editor.js#loadFileIntoCodeMirror() sends a fetch() call back to intramine_editor.pl using "req=loadfile", and intramine_editor.pl responds through LoadTheFile(), which passes back the file contents.
6. loadFileIntoCodeMirror() drops the response it receives into CodeMirror, which does all the hard work (syntax highlighting etc) from then on.
7. The same sub also calls cmAutoLinks.js#addAutoLinks(), which loads file links, web links, and image hovers for the currently visible text.

API
=====
Open a file for editing
-----------------------
**Action**: open a file for editing
**Request**: http://192.168.1.132:43131/Editor/?href=filePath
where filePath is a full path, such as C:/folder/afile.txt
**Response**: the basic HTML for the page with inclusion of editor.js and CodeMirror files. Note the text contents are filled in later when the page loads, see "Load contents of file" just below.
**For example**:
http://192.168.1.132:43131/Editor/?href=C:/perlprogs/IntraMine/libs/win_wide_filepaths.pm
**See also**: intramine_editor.pl#FullFile()

Load contents of file
---------------------
**Action**: load the text of a file into a CodeMirror display
**Request**: /?req=loadfile&file=PathToFile
**Response**: the full plain text of the source file, ready for putting in CodeMirror
**For example**: http://localhost:43125/?req=loadfile&file=C:/temp/afile.cpp
**See also**: editor.js#loadFileIntoCodeMirror(), intramine_editor.pl#LoadTheFile()

---
contents.txt
---
